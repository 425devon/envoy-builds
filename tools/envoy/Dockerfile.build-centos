ARG ENVOY_BUILD_IMAGE
FROM $ENVOY_BUILD_IMAGE

ARG BUILD_CMD

WORKDIR /envoy-sources

COPY . .

RUN yum update -y && \
    yum install -y \
    gcc \
    gcc-c++ \
    yum -y install centos-release-scl && \
    yum -y install devtoolset-6-gcc devtoolset-6-gcc-c++ && \

RUN bash -c "bazel/setup_clang.sh /opt/llvm"
RUN bash -c "$BUILD_CMD"
